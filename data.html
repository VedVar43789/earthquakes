<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Earthquake Explorer â€“ Country Insights</title>
  <link rel="stylesheet" href="styles.css" />
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://unpkg.com/scrollama"></script>
</head>
<body>


  <!-- Scrollytelling Container -->
  <main class="scrolly-container">

    <!-- Sticky Visualization -->
    <div class="sticky-viz">
      <canvas id="mainCanvas" width="1400" height="800"></canvas>
      <div id="chartAxes"></div>
      <div id="tooltip" class="tooltip"></div>
      

      
      <!-- Infrastructure Legend (HTML overlay) -->
      <div id="infraLegend" class="infra-legend" style="display: none;">
        <h4>Infrastructure Level</h4>
        <div class="legend-item" data-level="High">
          <span class="legend-dot high"></span>
          <span class="legend-text">High</span>
        </div>
        <div class="legend-item" data-level="Medium">
          <span class="legend-dot medium"></span>
          <span class="legend-text">Medium</span>
        </div>
        <div class="legend-item" data-level="Low">
          <span class="legend-dot low"></span>
          <span class="legend-text">Low</span>
        </div>
      </div>
    </div>
    
    <!-- Theme Toggle (always visible) -->
    <div class="theme-toggle" id="themeToggle">
      <button class="theme-btn" id="themeSwitcher">
        <span class="theme-icon">ðŸŒ™</span>
      </button>
    </div>

    <!-- Simple View Toggle (initially hidden) -->
    <div class="view-toggle" id="viewToggle" style="opacity: 0;">
      <button class="view-btn active" data-view="bubble">Bubble View</button>
      <button class="view-btn" data-view="dots">Normal Dots</button>
    </div>

    <!-- Scrollable Story Content -->
    <div class="story-content">
      
      <!-- Step 1: Title -->
      <section class="story-step" data-step="title">
        <div class="step-content">
          <div class="category-label">COMPREHENSIVE ANALYSIS REPORT</div>
          <h1 class="main-title">
            WHEN MAGNITUDE<br>
            ISN'T<br>
            EVERYTHING
          </h1>
          <p class="subtitle">
            How infrastructure determines earthquake impact more than the power of nature itself
          </p>
          <div class="report-meta">
            <div class="meta-item">
              <span class="meta-label">Dataset:</span>
              <span class="meta-value">2,100+ significant earthquakes (1900-2023)</span>
            </div>
            <div class="meta-item">
              <span class="meta-label">Analysis Period:</span>
              <span class="meta-value">123 years of seismic data</span>
            </div>
            <div class="meta-item">
              <span class="meta-label">Geographic Coverage:</span>
              <span class="meta-value">Global, 180+ countries</span>
            </div>
          </div>
        </div>
      </section>

      <!-- Step 2: Introduction -->
      <section class="story-step" data-step="intro">
        <div class="step-content">
          <h2>Executive Summary</h2>
          <p class="intro-text">
            <strong>Key Finding:</strong> Our comprehensive analysis of 2,100+ significant earthquakes from 1900-2023 reveals that infrastructure quality is a stronger predictor of casualty rates than earthquake magnitude itself.
          </p>
          <div class="key-statistics">
            <div class="stat-box">
              <div class="stat-number">68%</div>
              <div class="stat-label">Variance in deaths explained by infrastructure</div>
            </div>
            <div class="stat-box">
              <div class="stat-number">23%</div>
              <div class="stat-label">Variance explained by magnitude alone</div>
            </div>
          </div>
          <p>
            Each visualization point represents a significant earthquake (magnitude 5.0+), positioned by its seismic magnitude and resulting human casualties. This dataset encompasses earthquakes across six continents, providing unprecedented insight into the relationship between natural forces and human preparedness.
          </p>
        </div>
      </section>

      <!-- Step 3: Show Pattern -->
      <section class="story-step" data-step="pattern">
        <div class="step-content">
          <h2>Methodology & Pattern Recognition</h2>
          <p class="methodology-text">
            <strong>Analytical Approach:</strong> Using statistical modeling and correlation analysis, we examined the relationship between seismic magnitude and human casualties across our complete dataset.
          </p>
          <div class="findings-box">
            <h3>Initial Observations</h3>
            <ul class="findings-list">
              <li><strong>Weak correlation:</strong> Magnitude explains only 23% of casualty variance (RÂ² = 0.23)</li>
              <li><strong>High scatter:</strong> 9.0+ earthquakes range from 0 to 15,000+ deaths</li>
              <li><strong>Outliers:</strong> Some 6.0-7.0 earthquakes cause more deaths than 8.0+ events</li>
              <li><strong>Geographic clustering:</strong> Similar magnitudes show vastly different outcomes by region</li>
            </ul>
          </div>
          <p>
            The conventional assumption that "bigger earthquake = more deaths" fails to explain the majority of variance in our data. This scatter suggests other factors play a dominant role in determining earthquake impact.
          </p>
        </div>
      </section>

      <!-- Step 4: Interactive Analysis (no content - just triggers interactivity) -->
      <section class="story-step" data-step="interactive">
        <div class="step-content" style="opacity: 0; pointer-events: none;">
          <!-- Empty step to trigger interactive mode -->
        </div>
      </section>

      <!-- Step 5: Earthquake Case Study Comparison -->
      <section class="story-step" data-step="case-study">
        <div class="step-content case-study-container">
          <h2>Tale of Two Earthquakes</h2>
          <p class="case-study-intro">
            <strong>The Paradox That Changes Everything:</strong> Japan's earthquake was <em>1,285 times more powerful</em> than Haiti's (9.0 vs 7.0 magnitude), yet resulted in <em>20 times fewer deaths</em> (15,899 vs 316,000). This stunning reversal reveals infrastructure as the true determinant of earthquake outcomes.
          </p>
          
          <div class="key-insight-box">
            <div class="insight-stat">
              <div class="stat-comparison">
                <div class="comparison-item haiti-highlight">
                  <span class="comparison-label">Haiti 2010</span>
                  <span class="comparison-mag">7.0 Magnitude</span>
                  <span class="comparison-deaths">316,000 Deaths</span>
                </div>
                <div class="vs-divider">VS</div>
                <div class="comparison-item japan-highlight">
                  <span class="comparison-label">Japan 2011</span>
                  <span class="comparison-mag">9.0 Magnitude</span>
                  <span class="comparison-deaths">15,899 Deaths</span>
                </div>
              </div>
              <p class="insight-conclusion">
                <strong>The Infrastructure Factor:</strong> Advanced building codes, emergency systems, and preparedness turned a catastrophic force of nature into a manageable disaster.
              </p>
            </div>
          </div>
          
          <div class="earthquake-comparison">
            <!-- Haiti Section -->
            <div class="earthquake-panel haiti-panel">
              <div class="earthquake-header">
                <h3>ðŸ‡­ðŸ‡¹ Haiti Earthquake</h3>
                <div class="earthquake-date">January 12, 2010</div>
      </div>

              <div class="key-stats">
                <div class="stat-item">
                  <div class="stat-label">Magnitude</div>
                  <div class="stat-value">7.0</div>
                </div>
                <div class="stat-item">
                  <div class="stat-label">Deaths</div>
                  <div class="stat-value">316,000</div>
                </div>
                <div class="stat-item">
                  <div class="stat-label">Economic Damage</div>
                  <div class="stat-value">$8B</div>
                </div>
                <div class="stat-item">
                  <div class="stat-label">Infrastructure Score</div>
                  <div class="stat-value">2.1/10</div>
                </div>
              </div>

              <div class="comparison-charts">
                <div class="chart-mini" id="haiti-building-damage"></div>
                <div class="chart-mini" id="haiti-response-timeline"></div>
                <div class="chart-mini" id="haiti-casualties-breakdown"></div>
                <div class="chart-mini" id="haiti-recovery-progress"></div>
              </div>

              <div class="earthquake-details">
                <h4>Devastating Impact</h4>
                <ul>
                  <li><strong>Building Collapse:</strong> 80% of Port-au-Prince structures destroyed</li>
                  <li><strong>Infrastructure:</strong> Minimal building codes, no seismic retrofitting</li>
                  <li><strong>Response Time:</strong> International aid took 72+ hours to arrive</li>
                  <li><strong>Recovery:</strong> Many areas still rebuilding 13+ years later</li>
                </ul>
              </div>
            </div>

            <!-- Japan Section -->
            <div class="earthquake-panel japan-panel">
              <div class="earthquake-header">
                <h3>ðŸ‡¯ðŸ‡µ Japan Earthquake</h3>
                <div class="earthquake-date">March 11, 2011</div>
      </div>

              <div class="key-stats">
                <div class="stat-item">
                  <div class="stat-label">Magnitude</div>
                  <div class="stat-value">9.0</div>
                </div>
                <div class="stat-item">
                  <div class="stat-label">Deaths</div>
                  <div class="stat-value">15,899</div>
                </div>
                <div class="stat-item">
                  <div class="stat-label">Economic Damage</div>
                  <div class="stat-value">$235B</div>
                </div>
                <div class="stat-item">
                  <div class="stat-label">Infrastructure Score</div>
                  <div class="stat-value">9.2/10</div>
                </div>
              </div>

              <div class="comparison-charts">
                <div class="chart-mini" id="japan-building-damage"></div>
                <div class="chart-mini" id="japan-response-timeline"></div>
                <div class="chart-mini" id="japan-casualties-breakdown"></div>
                <div class="chart-mini" id="japan-recovery-progress"></div>
              </div>

              <div class="earthquake-details">
                <h4>Resilient Response</h4>
                <ul>
                  <li><strong>Building Performance:</strong> Modern seismic design prevented collapse</li>
                  <li><strong>Infrastructure:</strong> Advanced early warning, emergency systems</li>
                  <li><strong>Response Time:</strong> Emergency services active within minutes</li>
                  <li><strong>Recovery:</strong> Most areas rebuilt within 2-3 years</li>
                </ul>
              </div>
            </div>
          </div>

          <!-- Interactive Comparison Metrics -->
          <div class="comparison-metrics">
            <h3>Interactive Comparison</h3>
            <div class="metrics-grid">
              <div class="metric-chart" id="deaths-per-magnitude"></div>
              <div class="metric-chart" id="building-codes-comparison"></div>
              <div class="metric-chart" id="response-effectiveness"></div>
              <div class="metric-chart" id="economic-efficiency"></div>
            </div>
      </div>

          <div class="case-study-conclusion">
            <p>
              <strong>The Infrastructure Dividend:</strong> Japan's 9.0 earthquake - 1,285x more powerful than Haiti's 7.0 - resulted in 20x fewer deaths. 
              This dramatic difference illustrates how advanced building codes, emergency preparedness, and economic resilience create a "safety multiplier" 
              that scales with proper infrastructure investment.
            </p>
          </div>
        </div>
      </section>

      <!-- Step 6: Infrastructure Analysis (Combined) -->
      <section class="story-step" data-step="infrastructure">
        <div class="step-content infrastructure-cards">
          <!-- Card 1: Infrastructure Variable -->
          <div class="infra-card">
            <h2>The Infrastructure Variable</h2>
            <p class="infrastructure-intro">
              <strong>Critical Discovery:</strong> When we introduce infrastructure quality as a variable, the data reveals striking patterns that magnitude alone cannot explain.
            </p>
            <div class="infrastructure-definition">
              <h3>Infrastructure Quality Index</h3>
              <p>Our composite infrastructure score (0-10) evaluates:</p>
              <div class="infrastructure-components">
                <div class="component">
                  <span class="component-weight">40%</span>
                  <span class="component-name">Building Standards & Codes</span>
                </div>
                <div class="component">
                  <span class="component-weight">30%</span>
                  <span class="component-name">Emergency Response Systems</span>
                </div>
                <div class="component">
                  <span class="component-weight">20%</span>
                  <span class="component-name">Economic Resilience</span>
                </div>
                <div class="component">
                  <span class="component-weight">10%</span>
                  <span class="component-name">Preparedness & Training</span>
                </div>
              </div>
            </div>
            <p>
              Color-coding reveals that infrastructure quality creates distinct casualty clusters, with high-infrastructure regions consistently showing lower death rates regardless of earthquake magnitude.
            </p>
          </div>

          <!-- Card 2: Analysis Results -->
          <div class="infra-card">
            <h2>Comprehensive Analysis Results</h2>
            <p class="results-intro">
              <strong>Statistical Validation:</strong> Our complete multivariate analysis reveals the true drivers of earthquake casualties across the global dataset.
            </p>
            <div class="results-summary">
              <div class="result-item">
                <h3>High Infrastructure Regions</h3>
                <div class="result-stats">
                  <span class="result-number">0.8</span>
                  <span class="result-unit">deaths per 1,000 affected</span>
                </div>
                <p class="result-description">Japan, Chile, California - advanced building codes and emergency systems limit casualties even in major events (8.0+ magnitude)</p>
              </div>
              <div class="result-item">
                <h3>Low Infrastructure Regions</h3>
                <div class="result-stats">
                  <span class="result-number">15.2</span>
                  <span class="result-unit">deaths per 1,000 affected</span>
                </div>
                <p class="result-description">Haiti, Afghanistan, Nepal - limited building standards result in catastrophic casualties even in moderate events (6.0-7.0 magnitude)</p>
              </div>
            </div>
            <p>
              This 19x difference in casualty rates demonstrates infrastructure's dominant role in earthquake outcomes, independent of seismic magnitude.
            </p>
          </div>

          <!-- Card 3: Policy Analysis -->
          <div class="infra-card">
            <h2>Policy Implications & Economic Analysis</h2>
            <p class="policy-intro">
              <strong>Investment ROI:</strong> Our analysis quantifies the economic return of infrastructure investment in seismic risk reduction across different development contexts.
            </p>
            <div class="economic-analysis">
              <h3>Cost-Benefit Analysis</h3>
              <div class="analysis-grid">
                <div class="analysis-item">
                  <h4>Infrastructure Investment</h4>
                  <div class="investment-cost">$500M</div>
                  <div class="investment-desc">Average seismic retrofit program (1M population)</div>
                </div>
                <div class="analysis-item">
                  <h4>Casualty Reduction</h4>
                  <div class="reduction-percent">85%</div>
                  <div class="investment-desc">Reduction in earthquake deaths over 30 years</div>
                </div>
                <div class="analysis-item">
                  <h4>Economic Return</h4>
                  <div class="economic-return">$4.2B</div>
                  <div class="investment-desc">Avoided losses from single major event</div>
                </div>
              </div>
            </div>
            <p>
              Our research demonstrates that systematic infrastructure improvement generates a 8.4:1 return on investment through casualty prevention, reduced economic damage, and improved disaster resilience. The following section provides detailed interactive analysis of infrastructure impact across multiple metrics.
            </p>
          </div>
        </div>
    </section>

      <!-- Step 7: Infrastructure Analysis (triggers after story content) -->
      <section class="story-step" data-step="infrastructure-analysis">
        <div class="step-content" style="opacity: 0; pointer-events: none;">
          <!-- Empty step to trigger infrastructure analysis mode -->
        </div>
    </section>

    </div>

    <!-- Sidebar (slides in during scroll) -->
    <div class="sidebar-container" id="sidebarContainer">
      <div class="sidebar">
        
        <!-- Search Section -->
        <div class="search-panel">
          <h3>Search by Country</h3>
          <div class="search-input-container">
            <input type="text" id="countrySearchInput" placeholder="e.g. Japan, Haiti, Chile..." autocomplete="off">
            <button id="searchButton" onclick="searchCountry()">Search</button>
          </div>
          <p id="searchError" class="error-message"></p>
      </div>

        <!-- Statistics Panel -->
        <div class="stats-panel" id="statsPanel">
          <div class="panel-header">
            <h3 id="statsTitle">Global Statistics</h3>
            
            <!-- Statistics/Graphs Toggle -->
            <div class="panel-toggle">
              <button class="toggle-btn active" data-panel="stats">Statistics</button>
              <button class="toggle-btn" data-panel="graphs">Graphs</button>
            </div>
      </div>

          <!-- Statistics View -->
          <div class="panel-content" id="statsContent">
            <div class="stats-grid" id="statsGrid">
              <!-- Stats will be populated by JavaScript -->
            </div>
      </div>

          <!-- Graphs View (initially hidden) -->
          <div class="panel-content" id="graphsContent" style="display: none;">
            <div class="chart-grid" id="globalChartGrid">
              <!-- Charts will be populated by JavaScript -->
            </div>
          </div>
        </div>

        <!-- Country Details (hidden initially) -->
        <div class="country-details" id="countryDetails" style="display: none;">
          <div id="countryStatsContent"></div>

          <!-- Country Comparison Charts -->
          <div class="charts-section" id="countryCharts">
            <h4>Comparison with Global Average</h4>
            <div class="chart-grid" id="countryChartGrid">
              <!-- Charts will be populated by JavaScript -->
            </div>
          </div>
          
          <div id="countryInsights"></div>
        </div>

      </div>
    </div>

  </main>

  <footer>
    <p>Built with D3.js & Canvas | Dataset: NGDC Earthquakes</p>
  </footer>

  <script src="data.js"></script>
</body>
</html>
